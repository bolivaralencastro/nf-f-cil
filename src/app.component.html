<div class="min-h-screen bg-gray-900 text-white flex flex-col lg:flex-row">
  <!-- Sidebar Navigation (Desktop) -->
  <nav class="hidden lg:flex flex-col w-64 bg-gray-800 border-r border-gray-700 p-4 space-y-2">
    <div class="text-2xl font-bold text-teal-400 mb-6 px-2">Nota Fiscal Fácil</div>
    
    <!-- Home -->
    <button (click)="setView('home')" class="w-full flex items-center gap-3 px-3 py-2 rounded-lg" [class.bg-teal-500/20]="currentView() === 'home'" [class.text-teal-300]="currentView() === 'home'" [class.text-gray-400]="currentView() !== 'home'" [class.hover:bg-gray-700/50]="currentView() !== 'home'">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
        <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h7.5" />
      </svg>
      <span class="font-semibold">Início</span>
    </button>
    
    <!-- Lists -->
    <button (click)="setView('lists')" class="w-full flex items-center gap-3 px-3 py-2 rounded-lg" [class.bg-teal-500/20]="currentView() === 'lists'" [class.text-teal-300]="currentView() === 'lists'" [class.text-gray-400]="currentView() !== 'lists'" [class.hover:bg-gray-700/50]="currentView() !== 'lists'">
       <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
        <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 6.75h7.5M8.25 12h7.5m-7.5 5.25h7.5M3.75 6.75h.007v.008H3.75V6.75Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0ZM3.75 12h.007v.008H3.75V12Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm-.375 5.25h.007v.008H3.75v-.008Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
      </svg>
      <span class="font-semibold">Listas</span>
    </button>
    
    <!-- Map -->
     <button (click)="setView('map')" class="w-full flex items-center gap-3 px-3 py-2 rounded-lg" [class.bg-teal-500/20]="currentView() === 'map'" [class.text-teal-300]="currentView() === 'map'" [class.text-gray-400]="currentView() !== 'map'" [class.hover:bg-gray-700/50]="currentView() !== 'map'">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 6.75V15m6-6v8.25m.503-8.495 4.498 2.249a1.125 1.125 0 0 1 .503 1.001V18a1.125 1.125 0 0 1-1.125 1.125H4.125A1.125 1.125 0 0 1 3 18V9.996a1.125 1.125 0 0 1 .503-1.001l4.498-2.249a1.125 1.125 0 0 1 1.004 0Z" />
      </svg>
      <span class="font-semibold">Mapa</span>
    </button>

    <!-- History -->
    <button (click)="setView('history')" class="w-full flex items-center gap-3 px-3 py-2 rounded-lg" [class.bg-teal-500/20]="currentView() === 'history'" [class.text-teal-300]="currentView() === 'history'" [class.text-gray-400]="currentView() !== 'history'" [class.hover:bg-gray-700/50]="currentView() !== 'history'">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
      </svg>
      <span class="font-semibold">Histórico</span>
    </button>

    <div class="flex-grow"></div>
    
    <button (click)="openCaptureChoice()" class="w-full flex items-center justify-center gap-2 bg-teal-500 hover:bg-teal-600 text-white font-bold py-3 px-4 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 shadow-lg">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 3.75 9.375v-4.5ZM3.75 14.625c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5a1.125 1.125 0 0 1-1.125-1.125v-4.5ZM13.5 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 13.5 9.375v-4.5Z" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 6.75h.75v.75h-.75v-.75ZM6.75 16.5h.75v.75h-.75v-.75ZM16.5 6.75h.75v.75h-.75v-.75ZM13.5 13.5h7.5v7.5h-7.5v-7.5Z" />
      </svg>
      <span>Escanear Nota</span>
    </button>
  </nav>

  <!-- Main content -->
  <main class="flex-grow p-4 lg:p-8 pb-24 lg:pb-8 overflow-y-auto">
    <div [ngSwitch]="currentView()">
      <app-home *ngSwitchCase="'home'" (scanNew)="openCaptureChoice()" (showReports)="setView('reports')" />
      <app-smart-list *ngSwitchCase="'lists'" />
      <app-map *ngSwitchCase="'map'" />
      <app-history *ngSwitchCase="'history'" />
      <app-reports *ngSwitchCase="'reports'" (backToHome)="setView('home')" />
    </div>
  </main>

  <!-- Bottom Navigation (Mobile) -->
  <nav class="lg:hidden fixed bottom-0 left-0 right-0 bg-gray-800 border-t border-gray-700 flex justify-around items-center h-16">
    <!-- Home -->
    <button (click)="setView('home')" class="flex flex-col items-center justify-center w-full h-full" [class.text-teal-400]="currentView() === 'home'" [class.text-gray-400]="currentView() !== 'home'">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
        <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h7.5" />
      </svg>
      <span class="text-xs mt-1">Início</span>
    </button>

    <!-- Lists -->
    <button (click)="setView('lists')" class="flex flex-col items-center justify-center w-full h-full" [class.text-teal-400]="currentView() === 'lists'" [class.text-gray-400]="currentView() !== 'lists'">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
        <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 6.75h7.5M8.25 12h7.5m-7.5 5.25h7.5M3.75 6.75h.007v.008H3.75V6.75Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0ZM3.75 12h.007v.008H3.75V12Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm-.375 5.25h.007v.008H3.75v-.008Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
      </svg>
      <span class="text-xs mt-1">Listas</span>
    </button>

    <!-- Scan Button (Central) -->
    <div class="w-full flex justify-center">
      <button (click)="openCaptureChoice()" class="w-16 h-16 bg-teal-500 rounded-full flex items-center justify-center -mt-8 border-4 border-gray-900 shadow-lg hover:bg-teal-600 transition-transform transform hover:scale-110">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8 text-white">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 3.75 9.375v-4.5ZM3.75 14.625c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5a1.125 1.125 0 0 1-1.125-1.125v-4.5ZM13.5 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 13.5 9.375v-4.5Z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 6.75h.75v.75h-.75v-.75ZM6.75 16.5h.75v.75h-.75v-.75ZM16.5 6.75h.75v.75h-.75v-.75ZM13.5 13.5h7.5v7.5h-7.5v-7.5Z" />
        </svg>
      </button>
    </div>

    <!-- Map -->
    <button (click)="setView('map')" class="flex flex-col items-center justify-center w-full h-full" [class.text-teal-400]="currentView() === 'map'" [class.text-gray-400]="currentView() !== 'map'">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 6.75V15m6-6v8.25m.503-8.495 4.498 2.249a1.125 1.125 0 0 1 .503 1.001V18a1.125 1.125 0 0 1-1.125 1.125H4.125A1.125 1.125 0 0 1 3 18V9.996a1.125 1.125 0 0 1 .503-1.001l4.498-2.249a1.125 1.125 0 0 1 1.004 0Z" />
      </svg>
      <span class="text-xs mt-1">Mapa</span>
    </button>
    
    <!-- History -->
    <button (click)="setView('history')" class="flex flex-col items-center justify-center w-full h-full" [class.text-teal-400]="currentView() === 'history'" [class.text-gray-400]="currentView() !== 'history'">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
        </svg>
      <span class="text-xs mt-1">Histórico</span>
    </button>
  </nav>
</div>

<!-- Overlays -->
@if(showCaptureChoice()) {
  <div class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4 animate-fade-in">
    <div class="bg-gray-800 rounded-lg p-6 shadow-lg border border-gray-700 w-full max-w-md">
      <h3 class="text-xl font-bold text-teal-400 mb-6 text-center">Como você quer adicionar a nota?</h3>
      
      <!-- Button options -->
      <div class="space-y-4">
        <button (click)="startQrScanner()" class="w-full flex items-center justify-center gap-3 bg-gray-700 hover:bg-teal-800/50 text-white font-bold py-4 px-4 rounded-lg transition duration-300 ease-in-out border border-gray-600">
           <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 3.75 9.375v-4.5ZM3.75 14.625c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5a1.125 1.125 0 0 1-1.125-1.125v-4.5ZM13.5 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 13.5 9.375v-4.5Z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 6.75h.75v.75h-.75v-.75ZM6.75 16.5h.75v.75h-.75v-.75ZM16.5 6.75h.75v.75h-.75v-.75ZM13.5 13.5h7.5v7.5h-7.5v-7.5Z" />
          </svg>
          <span>Escanear QR Code</span>
        </button>
        <button (click)="startPhotoScanner()" class="w-full flex items-center justify-center gap-3 bg-gray-700 hover:bg-teal-800/50 text-white font-bold py-4 px-4 rounded-lg transition duration-300 ease-in-out border border-gray-600">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z" />
          </svg>
          <span>Fotografar Recibo</span>
        </button>
      </div>

      <!-- Divider -->
      <div class="my-6 flex items-center">
        <div class="flex-grow border-t border-gray-600"></div>
        <span class="flex-shrink mx-4 text-gray-400 text-sm">ou</span>
        <div class="flex-grow border-t border-gray-600"></div>
      </div>
      
      <!-- URL Input Form -->
      <form #urlForm="ngForm" (ngSubmit)="onUrlSubmit(urlForm.value.receiptUrl); urlForm.resetForm()">
        <label for="url-input" class="text-left block text-sm font-medium text-gray-300 mb-2">Inserir a partir de uma URL</label>
        <div class="flex gap-2">
          <input type="url" 
                 id="url-input"
                 name="receiptUrl" 
                 ngModel
                 required
                 placeholder="Cole o link da nota fiscal aqui..." 
                 class="flex-grow bg-gray-700 text-white placeholder-gray-500 p-3 rounded-lg border border-gray-600 focus:ring-2 focus:ring-teal-500 focus:border-teal-500 outline-none">
          <button type="submit" 
                  [disabled]="!urlForm.valid"
                  class="bg-teal-500 hover:bg-teal-600 text-white font-bold py-3 px-6 rounded-lg transition duration-300 disabled:bg-gray-600 disabled:cursor-not-allowed">
            Analisar
          </button>
        </div>
      </form>
      
      <button (click)="closeCaptureChoice()" class="mt-8 text-gray-400 hover:text-white font-semibold w-full text-center">
        Cancelar
      </button>
    </div>
  </div>
}

@if(showQrScanner()) {
  <app-scanner (scanSuccess)="onQrScanSuccess($event)" (scanCancel)="onQrScanCancelled()" />
}

@if(showPhotoScanner()) {
  <app-photo-capture (photoSuccess)="onPhotoScanSuccess($event)" (cancel)="onPhotoScanCancelled()" />
}