<div class="fixed inset-0 bg-black z-40 flex flex-col items-center justify-center animate-fade-in p-4">
  <div class="relative w-full max-w-2xl mx-auto aspect-[4/3] bg-gray-900 rounded-lg overflow-hidden shadow-lg border-2 border-teal-400">
    @if (captureState() === 'preview') {
      <video #video class="w-full h-full object-cover"></video>
      <div class="receipt-frame"></div>
      <div class="absolute top-4 left-4 right-4 text-center bg-black/50 p-2 rounded-md">
        <p class="text-white font-semibold">Enquadre o recibo e tire uma foto.</p>
      </div>
    }
    @if (captureState() === 'captured' && capturedImageSrc()) {
      <img [src]="capturedImageSrc()" alt="Recibo capturado" class="w-full h-full object-contain">
    }
    @if (captureState() === 'sending') {
      <div class="w-full h-full flex flex-col items-center justify-center bg-gray-800">
          <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-teal-500"></div>
          <p class="mt-4 text-lg text-gray-300">Extraindo link da foto...</p>
      </div>
    }
    <canvas #canvas hidden></canvas>
  </div>
  
  <div class="mt-6 flex items-center justify-center space-x-4 w-full">
    @if (captureState() === 'preview') {
      <button (click)="onCancel()" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-full transition duration-300">
        Cancelar
      </button>
      <button (click)="takePicture()" class="bg-teal-500 hover:bg-teal-600 text-white font-bold p-4 rounded-full transition duration-300 shadow-lg">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z" />
        </svg>
      </button>
    }
    @if (captureState() === 'captured') {
        <button (click)="retakePicture()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-full transition duration-300">
            Tentar Novamente
        </button>
        <button (click)="usePhoto()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-full transition duration-300">
            Usar Foto
        </button>
    }
  </div>
</div>