<div class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4 animate-fade-in">
  <div class="bg-gray-800 rounded-lg p-6 shadow-lg border border-gray-700 w-full max-w-2xl h-full max-h-[90vh] flex flex-col">
    <header class="text-center mb-4">
      <h2 class="text-3xl font-bold text-teal-400">Raio-X da Compra</h2>
      <p class="text-gray-400">An치lise instant칙nea da sua nota fiscal!</p>
    </header>

    <div class="flex-grow overflow-y-auto pr-2 space-y-3">
      @for (item of analyzedItems; track item.name) {
        <div class="bg-gray-700/50 p-4 rounded-lg">
          <div class="flex justify-between items-start">
            <div>
              <p class="font-bold text-white text-lg">{{ item.name }}</p>
              <p class="text-sm text-gray-400">{{ item.quantity }} {{ item.unit }} x R$ {{ item.unitPrice.toFixed(2) }} = <span class="font-semibold text-teal-300">R$ {{ item.totalPrice.toFixed(2) }}</span></p>
            </div>
            <span class="text-xs font-semibold bg-teal-800 text-teal-200 px-2 py-0.5 rounded-full whitespace-nowrap">{{ item.category }}</span>
          </div>

          @if(item.stats && item.stats.purchaseCount > 1) {
            <div class="mt-3 border-t border-gray-600 pt-3 text-sm space-y-2">
              <div class="flex items-center justify-between">
                <span class="text-gray-300">Term칪metro de Pre칞o:</span>
                <span class="font-bold text-base {{ getDiffColor(item.priceDiffPercent) }}">
                  @if (item.priceDiffPercent !== null) {
                    {{ item.priceDiffPercent > 0 ? '+' : '' }}{{ item.priceDiffPercent.toFixed(0) }}% 
                    <span>{{ item.priceDiffPercent < -5 ? '游릭' : (item.priceDiffPercent > 5 ? '游댮' : '游리') }}</span>
                  }
                </span>
              </div>
               <p class="text-xs text-gray-500 text-right">
                (vs. sua m칠dia pessoal de R$ {{ item.stats.averagePrice.toFixed(2) }})
              </p>

              @if(item.lastPrice !== null) {
                <div class="flex items-center justify-between pt-1">
                    <span class="text-gray-300">칔ltima compra:</span>
                    <span class="font-semibold text-gray-300">R$ {{ item.lastPrice.toFixed(2) }}</span>
                </div>
              }
            </div>
          } @else {
             <div class="mt-3 border-t border-gray-600 pt-3 text-sm">
                <p class="text-gray-500 text-center">Escaneie mais notas com este item para gerar an치lises.</p>
             </div>
          }
        </div>
      }
    </div>

    <footer class="mt-6 text-center">
       <button (click)="onDone()" class="bg-teal-500 hover:bg-teal-600 text-white font-bold py-3 px-8 rounded-full transition duration-300">
        Concluir
      </button>
    </footer>
  </div>
</div>
